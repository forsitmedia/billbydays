<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bill by Days ¬∑ Final bill split</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Canonical -->
  <link rel="canonical" href="https://billbydays.com/step3.html">

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="48x48" href="/favicon-48.png?v=1">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png?v=1">
  <link rel="icon" type="image/x-icon" href="/favicon.ico?v=1">

  <!-- Apple -->
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon-180.png?v=1">

  <!-- PWA -->
  <link rel="manifest" href="/site.webmanifest?v=1">
  <meta name="theme-color" content="#3b82f6">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --green: #16a34a;
      --border: #e5e7eb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --bg: #f9fafb;
      --card-bg: #ffffff;
      --shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
    }

   body {
  background: var(--bg);
  /* SAME padding as index.html (Step 1) */
  padding: calc(25px + env(safe-area-inset-top, 0px)) 20px calc(20px + env(safe-area-inset-bottom, 0px));
  display: flex;
  justify-content: center;
  min-height: 100vh;
}



    .app {
      width: 100%;
      max-width: 520px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
    }

    .title-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .app-logo {
      width: 36px;
      height: 36px;
      border-radius: 12px;
      object-fit: cover;
    }

    .title-block {
      display: flex;
      flex-direction: column;
    }

    .title {
  font-size: 28px;
  font-weight: 700;
  color: var(--text-main);
}

.subtitle {
  font-size: 14px;
  color: var(--text-muted);
}

    .mode-pill {
      font-size: 12px;
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #f3f4f6;
      color: #374151;
      white-space: nowrap;
    }

    .card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 14px 16px 16px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      margin-bottom: 14px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .section-title span {
      color: var(--green);
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      row-gap: 6px;
      column-gap: 8px;
      margin-top: 4px;
    }

    .summary-label {
      font-size: 12px;
      color: var(--text-muted);
    }

    .summary-value {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-main);
    }

    .summary-right {
      text-align: right;
    }

    /* Roommate list */

    .rm-grid {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .person-card {
      border-radius: 18px;
      border: 1px solid #e5e7eb;
      padding: 10px 12px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      cursor: pointer;
      transition: 0.15s ease;
    }

    .person-card:hover {
      box-shadow: 0 8px 20px rgba(15,23,42,0.08);
      transform: translateY(-2px);
    }

    .person-name-row {
      display: flex;
      align-items: center;
      gap: 8px;
      color: white
    }

    .person-dot {
      width: 12px;
      height: 12px;
      border-radius: 999px;
    }

    .person-name-row span {
      font-weight: 600;
      font-size: 15px;
    }

    .person-amount {
      font-size: 19px;
      font-weight: 700;
    }

    .person-perc {
      font-size: 12px;
      color: var(--text-muted);
    }

    .person-subline {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* Buttons + stats */

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 6px;
    }

    .pill-btn {
      border-radius: 999px;
      padding: 8px 13px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
    }

    .stats-card {
      margin-top: 6px;
      padding-top: 6px;
      border-top: 1px solid #e5e7eb;
      display: none;
      font-size: 13px;
      color: var(--text-muted);
    }

    .stats-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .stats-line {
      margin-bottom: 2px;
    }

    .stats-note {
      margin-top: 6px;
      font-size: 12px;
    }

        .stats-flat-card {
      margin: 6px 0 8px;
      padding: 8px 10px;
      border-radius: 12px;
      background:
        radial-gradient(circle at top left, rgba(96, 165, 250, 0.18), transparent),
        radial-gradient(circle at bottom right, rgba(248, 113, 113, 0.18), transparent);
      border: 1px solid rgba(148, 163, 184, 0.35);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      color: var(--text-main);
    }

    .stats-flat-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    .stats-flat-value {
      font-weight: 600;
      font-size: 16px;
    }

    .stats-flat-unit {
      font-size: 11px;
      margin-left: 4px;
      color: var(--text-muted);
    }

    .stats-chart-wrapper {
      position: relative;
      margin: 6px 0;
      height: 160px; /* space for the bars */
    }

    .stats-legend-title {
      margin-top: 4px;
      font-weight: 500;
      font-size: 12px;
      color: var(--text-muted);
    }

    .stats-legend-grid {
      margin-top: 4px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .stats-legend-item {
      display: flex;
      align-items: baseline;
      gap: 6px;
      font-size: 12px;
    }

    .stats-legend-label {
      font-weight: 600;
      min-width: 30px;
    }

    .stats-legend-name {
      flex: 1;
      color: var(--text-main);
    }

    .stats-legend-value {
      font-variant-numeric: tabular-nums;
    }


   /* Utility pills row (calc, report, tips, calendar) */
.pill-row {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 10px;
}

.pill-btn {
  flex: 1 1 calc(50% - 8px);   /* 2 pills per row ‚Üí tidy grid */
  border-radius: 999px;
  padding: 10px 12px;
  border: 1px solid #e5e7eb;
  background: #f9fafb;
  font-size: 13px;
  font-weight: 600;
  color: #111827;
  text-align: center;
  cursor: pointer;
  white-space: nowrap;
}

.pill-btn:hover {
  background: #eef2ff;
}

/* Bottom nav buttons (Edit / Start again) */
.footer-actions {
  margin-top: 14px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
}

.primary-btn,
.secondary-btn {
  flex: 1;
  border-radius: 16px;
  padding: 12px 16px;
  font-size: 14px;
  font-weight: 600;
  border: none;
  cursor: pointer;
  text-align: center;
}

.primary-btn {
  background: var(--green);
  color: #ffffff;
}

.secondary-btn {
  background: #e5e7eb;
  color: #111827;
}

/* Make ‚ÄúStart again‚Äù feel a bit more ‚Äúdanger‚Äù without being scary */
.footer-danger {
  background: #fee2e2;
  color: #b91c1c;
}

/* Dark / Pro mode keeps working ‚Äì this just piggybacks on your existing rules */
body.pro-mode .secondary-btn {
  background: #111827;
  color: #e5e7eb;
}

body.pro-mode .footer-danger {
  background: #1f2937;
  color: #fecaca;
}

    .secondary-btn {
      background: #e5e7eb;
      color: #111827;
    }

    /* Calendar overlay */

    .calendar-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .calendar-modal {
      width: 92%;
      max-width: 420px;
      background: white;
      border-radius: 22px;
      padding: 16px 16px 18px;
      box-shadow: 0 22px 45px rgba(15,23,42,0.4);
    }

    .cal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .cal-title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .cal-title {
      font-size: 16px;
      font-weight: 600;
    }

    .cal-subtitle {
      font-size: 11px;
      color: var(--text-muted);
    }

    .cal-close {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 4px 9px;
      font-size: 13px;
      background: #f9fafb;
      cursor: pointer;
    }

    /* Month grid */
.presence-grid {
  display: grid;
  grid-template-columns: repeat(7, minmax(0, 1fr));
  grid-auto-rows: 42px;
  gap: 6px;
  margin-top: 8px;
}

/* Each day square */
.presence-card {
  border-radius: 12px;
  background: #f3f4f6;
  padding: 4px 2px 3px;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-between;
  min-height: 38px;
  box-sizing: border-box;
}

.presence-card.out-of-range {
  opacity: 0.25;
  cursor: default;
}

.cal-day-number {
  font-size: 13px;
  font-weight: 500;
}

/* Little bars inside each day */
.presence-bars {
  display: flex;
  gap: 2px;
  width: 80%;
  justify-content: center;
  margin-top: 3px;
}

.presence-bar {
  flex: 1;
  height: 3px;
  border-radius: 999px;
  background: #e5e7eb;
  overflow: hidden;
}

/* Month header + weekday row */
.cal-month-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 4px;
}

.cal-month-label {
  font-size: 14px;
  font-weight: 600;
}

.cal-nav-btn {
  border: none;
  border-radius: 999px;
  padding: 2px 10px;
  background: #f3f4f6;
  font-size: 14px;
  cursor: pointer;
}

.cal-nav-btn:disabled {
  opacity: 0.3;
  cursor: default;
}

.cal-weekdays-row {
  margin-top: 8px;
  display: grid;
  grid-template-columns: repeat(7, minmax(0, 1fr));
  font-size: 11px;
  text-align: center;
  color: var(--text-muted);
}

.cal-weekdays-row div {
  padding-bottom: 4px;
}


    .presence-date {
      font-weight: 600;
      font-size: 14px;
    }

    .presence-meta {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .presence-bars {
      display: flex;
      gap: 4px;
    }

    .presence-bar {
      flex: 1;
      height: 5px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
    }

    .presence-inner {
      height: 100%;
      width: 100%;
      border-radius: inherit;
    }

    .day-info {
      display: none;
    }

    .day-info-back {
      border: none;
      background: none;
      font-size: 13px;
      margin: 8px 0 6px;
      cursor: pointer;
      color: #4b5563;
    }

    .day-focus-card {
      border-radius: 16px;
      border: 1px solid #e5e7eb;
      padding: 10px;
      margin-bottom: 8px;
    }

    .day-focus-date {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .day-focus-bars .presence-bar {
      margin-bottom: 3px;
    }

    .day-roommate-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 3px;
    }

    .day-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
    }

    .day-roommate-name {
      font-size: 13px;
    }

    .day-roommate-status {
      font-size: 13px;
    }

    .day-roommate-status strong {
      font-weight: 600;
    }

    .day-points {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* Calculation overlay */

    .calc-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2100;
        backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);

    }

    .calc-modal {
      width: 92%;
      max-width: 420px;
      background: white;
      border-radius: 22px;
      padding: 16px 16px 18px;
      box-shadow: 0 22px 45px rgba(15,23,42,0.4);
      max-height: 80vh;
      overflow-y: auto;
    }

    .calc-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .calc-title {
      font-size: 16px;
      font-weight: 600;
    }

    .calc-close {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 4px 9px;
      font-size: 13px;
      background: #f9fafb;
      cursor: pointer;
    }

    .calc-body {
      font-size: 13px;
      color: var(--text-muted);
    }

    .step-block {
      margin-bottom: 10px;
    }

    .step-label {
      font-weight: 600;
      margin-bottom: 3px;
    }

    .calc-table {
      border-top: 1px solid #e5e7eb;
      padding-top: 6px;
      margin-top: 8px;
    }

    .calc-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .calc-left {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .calc-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
    }


        /* REPORT ‚Äì ANALYTICS SCREEN STYLE */

    .report-overlay {
      align-items: center;
      padding: 16px;
      background: rgba(15, 23, 42, 0.55);
      backdrop-filter: blur(10px);
    }

    .report-overlay .calc-modal {
      max-width: 480px;
      width: 100%;
      max-height: calc(100% - 32px);
      margin: 0 auto;
      background: #f3f4f6;
      border-radius: 28px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 28px 80px rgba(15, 23, 42, 0.45);
    }

    .report-header-hero {
      padding: 18px 20px 16px;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
    }

    .report-header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }

    .report-title-main {
      font-size: 18px;
      font-weight: 700;
    }

    .report-subtitle {
      font-size: 13px;
      opacity: 0.9;
    }

    .report-header-meta {
      font-size: 11px;
      opacity: 0.9;
      margin-top: 2px;
    }

    .report-close-white {
      background: rgba(15, 23, 42, 0.25);
      color: white;
      border: none;
      border-radius: 999px;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
    }

    .report-body-scroll {
      padding: 12px 16px 18px;
      overflow-y: auto;
      flex: 1;
    }

    .report-section {
      margin-top: 8px;
    }

    .report-card {
      background: #ffffff;
      border-radius: 18px;
      padding: 12px 14px;
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.06);
    }

    .report-section-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
      color: #111827;
    }

    .report-card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
    }

    .report-card-title {
      font-size: 13px;
      font-weight: 600;
    }

    .report-card-subtitle {
      font-size: 11px;
      color: #9ca3af;
    }

    .report-overview-line {
      font-size: 12px;
      color: #4b5563;
      margin-bottom: 2px;
    }

    .report-charts-row {
      display: flex;
      gap: 10px;
    }

    .report-chart-card {
      flex: 1;
      background: #f3f4f6;
      border-radius: 14px;
      padding: 6px 6px 10px;
      text-align: center;
    }

    .report-chart-title {
      font-size: 11px;
      margin-bottom: 4px;
      color: #4b5563;
    }

    .report-chart-card canvas {
      width: 100% !important;
      height: 110px !important;
    }

    .report-roommate-card {
      margin-top: 8px;
      padding: 10px 12px;
      border-radius: 16px;
      background: #ffffff;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.04);
    }

    .report-roommate-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 4px;
    }

    .report-roommate-name {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .report-roommate-total {
      font-size: 14px;
      font-weight: 600;
    }

    .report-roommate-lines {
      font-size: 12px;
      color: #6b7280;
      line-height: 1.5;
    }

    .report-footer-btns {
      padding: 10px 16px 14px;
      border-top: 1px solid #e5e7eb;
      background: #f3f4f6;
      display: flex;
      justify-content: flex-end;
    }

    .report-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
    }

    /* Make the formula line smaller so it never feels heavy */
    .calc-formula span:last-child {
      font-size: 11px;
      color: #6b7280;
      max-width: 240px;
      display: inline-block;
      text-align: right;
    }


    /* Roommate detail overlay */

    .rm-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2050;
        backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);

    }

    .rm-modal {
      width: 92%;
      max-width: 420px;
      background: white;
      border-radius: 22px;
      padding: 16px 16px 18px;
      box-shadow: 0 22px 45px rgba(15,23,42,0.4);
      max-height: 80vh;
      overflow-y: auto;
    }

    .rm-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .rm-modal-title-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .rm-modal-dot {
      width: 14px;
      height: 14px;
      border-radius: 999px;
    }

    .rm-modal-title {
      font-size: 16px;
      font-weight: 600;
    }

    .rm-modal-close {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 4px 9px;
      font-size: 13px;
      background: #f9fafb;
      cursor: pointer;
    }

    .rm-modal-total {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .rm-modal-sub {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .rm-modal-summary-grid {
      display: grid;
      grid-template-columns: repeat(2,1fr);
      row-gap: 4px;
      column-gap: 8px;
      font-size: 13px;
      margin-bottom: 10px;
    }

    .rm-modal-label {
      color: var(--text-muted);
    }

    .rm-modal-value {
      font-weight: 600;
    }

    .rm-modal-exp-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .rm-modal-exp-row {
      margin-bottom: 6px;
      font-size: 13px;
    }

    .rm-modal-exp-main {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1px;
    }

    .rm-modal-exp-left {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .rm-modal-exp-icon {
      font-size: 15px;
    }

    .rm-modal-exp-name {
      font-weight: 500;
    }

    .rm-modal-exp-amount {
      font-weight: 600;
    }

    .rm-modal-exp-detail {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* PRO THEME (same palette as Step 1) */

    body.pro-mode {
      background: radial-gradient(circle at top, #4f46e5 0, #020617 55%);
    }

    body.pro-mode .card {
      background: #020617;
      border-color: #111827;
      box-shadow: 0 18px 40px rgba(0,0,0,0.55);
    }

    body.pro-mode .title {
      color: #e5e7eb;
    }

    body.pro-mode .subtitle {
      color: #a5b4fc;
    }

    body.pro-mode .summary-label,
    body.pro-mode .person-subline,
    body.pro-mode .person-perc,
    body.pro-mode .stats-card,
    body.pro-mode .cal-subtitle,
    body.pro-mode .day-roommate-status,
    body.pro-mode .day-points {
      color: #9ca3af;
    }

    body.pro-mode .summary-value,
    body.pro-mode .person-amount,
    body.pro-mode .section-title {
      color: #e5e7eb;
    }

    body.pro-mode .person-card {
      background: #020617;
      border-color: #1f2937;
    }

    body.pro-mode .pill-btn {
      background: #020617;
      border-color: #1f2937;
      color: #e5e7eb;
    }

    body.pro-mode .secondary-btn {
      background: #111827;
      color: #e5e7eb;
    }

    body.pro-mode .mode-pill {
      background: #1e1b4b;
      border-color: #6366f1;
      color: #e5e7eb;
    }

    body.pro-mode .calendar-modal,
    body.pro-mode .calc-modal,
    body.pro-mode .rm-modal {
      background: #020617;
      border-color: #1f2937;
      color: #e5e7eb;
    }

    body.pro-mode .cal-close,
    body.pro-mode .calc-close,
    body.pro-mode .rm-modal-close {
      background: #020617;
      border-color: #1f2937;
      color: #e5e7eb;
    }

    body.pro-mode .presence-card,
    body.pro-mode .day-focus-card {
      background: #020617;
      border-color: #1f2937;
    }

    body.pro-mode .calc-body,
    body.pro-mode .rm-modal-sub,
    body.pro-mode .rm-modal-exp-detail {
      color: #9ca3af;
    }


    /* Global line height for better readability */
.calc-container {
  line-height: 1.55;
}

/* Every block has healthy vertical spacing */
.step-block {
  margin-bottom: 22px; /* was too small before */
}

/* Title of each step */
.step-label {
  font-size: 17px;
  font-weight: 600;
  margin-bottom: 8px;
}

/* Paragraph spacing */
.calc-step-text {
  margin-top: 4px;
  margin-bottom: 10px;
  line-height: 1.55;
  font-size: 15px;
}

/* Bullet lists improved */
.calc-list {
  margin: 6px 0 10px 22px; /* indent + spacing */
  padding-left: 0;
  list-style-type: disc;
}

.calc-list li {
  margin-bottom: 6px;
  font-size: 15px;
  line-height: 1.55;
}

/* Divider spacing before "In this split" */
.calc-table {
  margin-top: 16px;
  padding-top: 12px;
  border-top: 1px solid #e5e7eb;
}





.person-split {
  margin-top: 10px;
  margin-bottom: 10px;
  padding: 10px 10px 8px;
  border-radius: 12px;
  background: #f9fafb;
}

.person-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
}

.person-name {
  font-weight: 500;
}

.person-line {
  display: flex;
  justify-content: space-between;
  font-size: 13px;
  margin-bottom: 2px;
}

.person-line span:first-child {
  color: #6b7280; /* label */
}

.person-line span:last-child {
  font-variant-numeric: tabular-nums;
}

.person-total {
  margin-top: 6px;
  font-size: 13px;
}

.person-total strong {
  font-size: 14px;
}
  
.calc-row-total {
  margin-top: 6px;
}


    .upgrade-popup {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #1f2937;
      color: white;
      padding: 10px 16px;
      border-radius: 12px;
      display: none;
      font-size: 14px;
    }

.calc-formula span:last-child {
  font-size: 10px;        /* smaller so it always fits */
  color: #12121263;         /* soft grey */
  display: inline-block;
  text-align: right;
  white-space: nowrap;    /* IMPORTANT ‚Üí prevents breaking into two lines */
}


/* ========= REPORT OVERLAY (PRO) ========= */

.report-overlay {
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.75);
  backdrop-filter: blur(20px);
  display: none;             /* JS will set to flex */
  align-items: center;
  justify-content: center;
  z-index: 2000;
}

.report-shell {
  width: min(420px, 100% - 32px);
  max-height: min(760px, 100% - 32px);
  background: #020617;
  border-radius: 28px;
  box-shadow: 0 24px 60px rgba(0, 0, 0, 0.45);
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* Header */

.report-header {
  padding: 18px 18px 14px;
  background: linear-gradient(135deg, #16a34a, #22c55e);
  color: #fff;
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 12px;
}

.report-title {
  font-size: 20px;
  font-weight: 700;
}

.report-subtitle {
  font-size: 13px;
  opacity: 0.9;
  margin-top: 3px;
}

.report-meta {
  font-size: 12px;
  opacity: 0.9;
  margin-top: 6px;
}

.report-close-btn {
  border: none;
  background: rgba(15, 23, 42, 0.22);
  color: #fff;
  width: 28px;
  height: 28px;
  border-radius: 999px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

/* Hero charts */

.report-hero {
  padding: 14px 16px 10px;
  background: #0f172a;
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;
}

.report-hero-card {
  background: rgba(15, 23, 42, 0.95);
  border-radius: 18px;
  padding: 10px 10px 6px;
}

.report-hero-label {
  font-size: 11px;
  color: #e5e7eb;
  text-align: center;
  margin-bottom: 4px;
}

.report-hero-card canvas {
  width: 100%;
  height: 120px;
}

/* Body sections */

.report-sections {
  padding: 12px 16px 10px;
  background: #020617;
  overflow-y: auto;
}

.report-section {
  background: #f9fafb;
  border-radius: 18px;
  padding: 12px 14px;
  margin-bottom: 10px;
}

.report-section-title {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 6px;
  color: #111827;
}

.report-kv-row {
  display: flex;
  justify-content: space-between;
  font-size: 13px;
  margin-bottom: 2px;
  color: #374151;
}

.report-kv-row strong {
  font-weight: 600;
}

.report-expense-row {
  font-size: 13px;
  margin-bottom: 2px;
  color: #374151;
}

.report-expense-row span:first-child {
  margin-right: 4px;
}

/* Split by roommate cards */

.report-roommate-card {
  background: #ffffff;
  border-radius: 14px;
  padding: 8px 10px;
  margin-bottom: 8px;
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.03);
}

.report-roommate-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 13px;
  margin-bottom: 2px;
}

.report-roommate-meta {
  font-size: 12px;
  color: #6b7280;
}

/* Footer */

.report-footer {
  padding: 10px 16px 14px;
  background: #020617;
  border-top: 1px solid rgba(15, 23, 42, 0.6);
}

.report-share-btn {
  width: 100%;
  padding: 10px 14px;
  border-radius: 999px;
  border: none;
  background: #111827;
  color: #f9fafb;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
}


.report-hero-card canvas {
  display: block;
  width: 100%;
  max-width: 180px;
  height: 180px;        /* fixed height so it never collapses */
  margin: 0 auto;
}

/* ===== Apple-style highlight: Bill breakdown ===== */

.report-highlight-card {
  background: #f9fafb;
  border-radius: 20px;
  padding: 14px 16px 12px;
  margin-bottom: 12px;
  box-shadow: 0 10px 26px rgba(15, 23, 42, 0.18);
}

.report-highlight-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
  margin-bottom: 10px;
}

.report-highlight-title {
  font-size: 15px;
  font-weight: 600;
  color: #111827;
}

.report-highlight-sub {
  font-size: 12px;
  color: #6b7280;
  margin-top: 2px;
}

.report-highlight-meta {
  font-size: 12px;
  color: #6b7280;
  text-align: right;
}

.report-highlight-body {
  display: flex;
  align-items: center;
  gap: 12px;
}

.report-highlight-chart {
  width: 90px;
  height: 90px;
  flex-shrink: 0;
}

.report-highlight-chart canvas {
  width: 100% !important;
  height: 100% !important;
}

.report-highlight-text {
  flex: 1;
  font-size: 12px;
  color: #374151;
  line-height: 1.45;
}

.report-highlight-line + .report-highlight-line {
  margin-top: 4px;
}

.report-highlight-line strong {
  font-weight: 600;
  color: #111827;
}

/* ===== BILL COMPOSITION CARD ===== */

.report-comp-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 8px;
  margin-bottom: 10px;
}

.report-comp-card {
  background: #ffffff;
  border-radius: 14px;
  padding: 8px 10px;
  box-shadow: 0 4px 10px rgba(15, 23, 42, 0.04);
  font-size: 12px;
  color: #374151;
}

.report-comp-header {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 2px;
}

.report-comp-icon {
  font-size: 16px;
}

.report-comp-name {
  font-weight: 600;
  font-size: 13px;
}

.report-comp-total {
  font-weight: 600;
  margin-bottom: 2px;
}

.report-comp-meta {
  color: #6b7280;
  margin-bottom: 2px;
}

.report-comp-period {
  color: #9ca3af;
  font-size: 11px;
}

/* Chart container inside the card */

.report-comp-chart-card {
  margin-top: 4px;
  padding-top: 8px;
  border-top: 1px solid #e5e7eb;
}

.report-comp-chart-title {
  font-size: 12px;
  color: #6b7280;
  margin-bottom: 4px;
}

#billCompositionChart {
  display: block;
  margin: 0 auto 8px auto;   /* centers the ring */
  width: 220px;
  height: 220px;
}

/* ===== KPI CARD (Portugal benchmark) ===== */

/* outer container card (whole section) */
.kpi-card {
  margin-top: 10px;
  padding: 10px 12px 12px;
  border-radius: 16px;
  background: radial-gradient(circle at top left, rgba(59, 130, 246, 0.12), transparent),
              radial-gradient(circle at bottom right, rgba(34, 197, 94, 0.12), transparent);
  border: 1px solid rgba(148, 163, 184, 0.4);
  box-shadow: 0 10px 26px rgba(15, 23, 42, 0.08);
  font-size: 13px;
}

/* small title + pill row */
.kpi-header-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  margin-bottom: 6px;
}

.kpi-utility-label {
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: #6b7280;
}

.kpi-household-label {
  font-size: 12px;
  color: #4b5563;
}

/* score pill (top-right) */

.kpi-score-pill {
  min-width: 52px;
  padding: 4px 8px;
  border-radius: 999px;
  background: #111827;
  color: #f9fafb;
  font-size: 12px;
  display: flex;
  align-items: baseline;
  justify-content: center;
  gap: 2px;
}

.kpi-score-pill span:first-child {
  font-weight: 700;
  font-size: 16px;
}

.kpi-score-max {
  opacity: 0.7;
}


/* ===== PORTUGAL KPI TILES (gauge + monthly cost) ===== */

.kpi-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 10px;
  margin-top: 8px; /* a bit more space from section title */
}

.kpi-tile {
  background: #f9fafb;
  border-radius: 18px;
  padding: 12px 14px 14px;
  box-shadow: 0 8px 22px rgba(15, 23, 42, 0.06);
}

.kpi-tile-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 6px;
}

.kpi-tile-title {
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: #6b7280;
}

.kpi-tile-sub {
  font-size: 12px;
  color: #4b5563;
  margin-bottom: 8px;
}


/* --- KPI semicircle gauge --- */
.kpi-gauge-wrapper {
  margin-top: 4px;
}

/* Box that cuts the circle into a semicircle */
.kpi-gauge {
  position: relative;
  width: 100%;
  max-width: 220px;
  height: 110px;            /* controls overall size */
  margin: 0 auto;
  overflow: hidden;          /* hides the lower half of the circle */
}

/* Full circle ‚Äì we only see the top half */
.kpi-gauge-arc {
  position: absolute;
  left: 50%;
  top: 10px;                 /* puts the circle center on the bottom edge */
  width: 200px;
  height: 200px;
  transform: translateX(-50%);
  border-radius: 50%;
  background: conic-gradient(
    from 180deg,
    /* left side of semicircle: red ‚Üí yellow ‚Üí green */
    #ef4444 0deg 130deg,      /* red (0‚Äì~30) */
    #facc15 130deg 230deg,    /* yellow (~30‚Äì~60) */
    #22c55e 230deg 280deg,   /* green (~60‚Äì~80) */
    /* right side of semicircle: grey */
    #e5e7eb 180deg 360deg
  );
}

/* Inner white hole ‚Üí donut look */
.kpi-gauge-arc::before {
  content: "";
  position: absolute;
  inset: 32%;               /* ring thickness */
  background: #f9fafb;      /* same as card background */
  border-radius: 50%;
}

/* Needle sitting on bottom centre */
.kpi-gauge-needle {
  position: absolute;
  left: 50%;
  bottom: 0;
  width: 3px;
  height: 95%;
  background: #020617;
  border-radius: 999px;
  transform-origin: 50% 100%;
  transform: translateX(-50%) rotate(-90deg); /* JS updates this angle */
  z-index: 2;
}

/* 0‚Äì50‚Äì100 baseline under the gauge */
.kpi-gauge-scale {
  position: relative;
  margin-top: 6px;
  display: flex;
  justify-content: space-between;
  font-size: 10px;
  color: #9ca3af;
  --kpi-score: 50;
  --kpi-color: #22c55e;
}

.kpi-gauge-scale::before {
  content: "";
  position: absolute;
  left: 10%;
  right: 10%;
  top: 50%;
  transform: translateY(-50%);
  height: 2px;
  background: #e5e7eb;
  border-radius: 999px;
  z-index: 0;
}

.kpi-gauge-scale::after {
  content: "";
  position: absolute;
  left: 10%;
  top: 50%;
  transform: translateY(-50%);
  height: 2px;
  background: var(--kpi-color);
  border-radius: 999px;
  width: calc((var(--kpi-score) / 100) * 80%);
  z-index: 1;
}

.kpi-gauge-scale span {
  background: #f9fafb;
  padding: 0 3px;
  z-index: 2;
}

/* ===== MONTHLY COST TILE STYLING ===== */

.kpi-rows {
  margin-top: 6px;
  padding: 8px 10px;
  border-radius: 12px;
  background: #eef2ff;              /* soft background for the numbers */
  border: 1px solid #e5e7eb;
}

.kpi-row {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  font-size: 13px;
  margin-bottom: 4px;
}

.kpi-row span:first-child {
  color: #6b7280;                   /* label */
}

.kpi-row span:last-child {
  font-weight: 600;                 /* value */
  color: #111827;
  font-variant-numeric: tabular-nums;
}

.kpi-row:last-child {
  margin-bottom: 0;
}

/* ‚ÄúYou are 91.5% below‚Ä¶‚Äù sentence */
#kpiDiffSummary {
  font-size: 12px;
  color: #6b7280;
  line-height: 1.45;
}

/* Footnote with sources */
.kpi-footnote {
  margin-top: 8px;
  font-size: 10px;
  line-height: 1.4;
  color: #9ca3af;
}

/* Make tip titles bigger, clearer and more modern */
.step-label {
  font-size: 15px;
  font-weight: 700;
  color: #111827;
  margin-bottom: 4px;
  display: flex;
  align-items: center;
  gap: 6px;
}

/* Improve readability of paragraph text */
.calc-step-text {
  font-size: 13px;
  line-height: 1.45;
  color: #4b5563;
}

/* Add spacing between steps */
.step-block {
  margin-bottom: 14px;
}

/* Strong numbers inside paragraphs */
.calc-step-text strong {
  color: #111827;
  font-weight: 700;
}

/* In PRO MODE ‚Üí white mode */
body.pro-mode .step-label {
  color: #e5e7eb;
}

body.pro-mode .calc-step-text {
  color: #d1d5db;
}

body.pro-mode .calc-step-text strong {
  color: #ffffff;
}

#calendarOverlay {
  position: fixed;
  inset: 0;
  background: rgba(15,23,42,0.55);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 2100;
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
}

  </style>
</head>

<body>
  <div class="app">
    <header>
      <div class="title-left">
        <img src="logo.png" alt="Bill by Days logo" class="app-logo" />
        <div class="title-block">
          <div class="title">Bill by Days</div>
          <div class="subtitle">Step 3 ¬∑ Final bill split</div>
        </div>
      </div>
      <div id="modePill" class="mode-pill">Free mode ¬∑ tap to simulate Pro</div>
    </header>

    <!-- SMALL SUMMARY CARD -->
    <section class="card">
      <div class="summary-grid">
        <div>
          <div class="summary-label">Total bill</div>
          <div id="sumBill" class="summary-value">‚Ç¨0.00</div>
        </div>
        <div class="summary-right">
          <div class="summary-label">Period</div>
          <div id="summaryPeriod" class="summary-value">‚Äì</div>
        </div>
        <div>
          <div class="summary-label">Total days</div>
          <div id="summaryDays" class="summary-value">0 days</div>
        </div>
        <div class="summary-right">
          <div class="summary-label">Roommates</div>
          <div id="summaryRoommates" class="summary-value">0</div>
        </div>
      </div>
    </section>

    <!-- ROOMMATE CARDS -->
    <section class="card">
      <div class="section-title">
        Here‚Äôs what each roommate has to <span>pay</span>.
      </div>
      <div class="summary-label" style="margin-bottom:8px;">
        Tap a card to see how their amount is built from fixed parts and each expense.
      </div>
      <div id="cardsGrid" class="rm-grid"></div>
    </section>

       <!-- ACTIONS + STATS -->
    <section class="card">
      <!-- Top utility pills -->
      <div class="pill-row">
        <button class="pill-btn" id="openCalcBtn">
          How it‚Äôs calculated üßÆ
        </button>

        <button class="pill-btn" id="exportReportBtn">
          Show full report üìÑ
        </button>

        <button class="pill-btn" id="openTipsBtn">
          How to save on bills üí°
        </button>

        <button class="pill-btn" id="openCalendarBtn">
          View full calendar üìÖ
        </button>

          <button class="pill-btn" id="shareFriendsBtn">Share with Roomates üì§</button>

           <button class="pill-btn" id="openFeedbackBtn"
    style="background:#fef3c7;border-color:#facc15;color:#92400e;">
    ‚≠ê Leave feedback
  </button>

      </div>

      <!-- Stats card -->
      <div id="statsCard" class="stats-card"></div>

      <!-- Big navigation buttons at the bottom -->
      <div class="footer-actions">
        <button class="secondary-btn" id="backBtn">
          ‚Üê Edit absences
        </button>
        <button class="secondary-btn footer-danger" id="restartBtn">
          Start again ‚Ü∫
        </button>
      </div>
    </section>


  <!-- CALENDAR OVERLAY -->
  <div id="calendarOverlay" class="calendar-overlay">
    <div class="calendar-modal">
      <div class="cal-header">
        <div class="cal-title-block">
          <div class="cal-title">Presence calendar</div>
          <div class="cal-subtitle">
            Tap a day to see who was home, who was away, and how that day‚Äôs point was split.
          </div>
        </div>
        <button id="calCloseBtn" class="cal-close">‚úï</button>
      </div>
      <div class="cal-body">
  <div class="cal-month-header">
    <button id="calPrevBtn" class="cal-nav-btn">‚Äπ</button>
    <div id="calMonthLabel" class="cal-month-label"></div>
    <button id="calNextBtn" class="cal-nav-btn">‚Ä∫</button>
  </div>

  <div class="cal-weekdays-row">
    <div>Mon</div>
    <div>Tue</div>
    <div>Wed</div>
    <div>Thu</div>
    <div>Fri</div>
    <div>Sat</div>
    <div>Sun</div>
  </div>

  <div id="presenceGrid" class="presence-grid"></div>

  <!-- DAY DETAIL -->
  <div id="dayInfo" class="day-info">

          <button id="dayInfoBackBtn" class="day-info-back">‚Üê Back to calendar</button>
          <div class="day-focus-card">
            <div id="dayInfoTitle" class="day-focus-date"></div>
            <div id="dayInfoBars" class="day-focus-bars"></div>
            <div id="dayInfoList"></div>
            <div id="dayInfoSplit" class="day-points"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CALCULATION OVERLAY -->
  <div id="calcOverlay" class="calc-overlay">
    <div class="calc-modal">
      <div class="calc-header">
        <div class="calc-title">How this split is calculated</div>
        <button id="calcCloseBtn" class="calc-close">‚úï</button>
      </div>
      <div id="calcContent" class="calc-body"></div>
    </div>
  </div>

  <!-- TIPS OVERLAY -->
<div id="tipsOverlay" class="calc-overlay">
  <div class="calc-modal">
    <div class="calc-header">
      <div class="calc-title">üí° 10 Steps to Save Money on Utilities</div>
      <button id="tipsCloseBtn" class="calc-close">‚úï</button>
    </div>

    <div id="tipsContent" class="calc-body">

      <div class="step-block">
        <div class="step-label">üî• 1 ¬∑ Heat only the rooms you actually use</div>
        <p class="calc-step-text">
          Heating represents <strong>~60%</strong> of energy use.
          Closing doors and heating only active rooms can save shared homes
          <strong>15‚Äì30%</strong> on winter bills.
        </p>
      </div>

      <div class="step-block">
        <div class="step-label">üå°Ô∏è 2 ¬∑ Drop the thermostat by just 1¬∞C</div>
        <p class="calc-step-text">
          Lowering the thermostat by <strong>1¬∞C</strong> cuts heating costs
          by up to <strong>10%</strong> ‚Äî with almost no comfort difference.
        </p>
      </div>

      <div class="step-block">
        <div class="step-label">üöø 3 ¬∑ Shorten showers + low-flow showerhead</div>
        <p class="calc-step-text">
          Hot water = <strong>15‚Äì20%</strong> of energy use.
          Keeping showers under <strong>8 minutes</strong> saves
          <strong>20‚Äì40%</strong>. Low-flow showerheads save
          <strong>30‚Äì50%</strong> more water.
        </p>
      </div>

      <div class="step-block">
        <div class="step-label">üß∫ 4 ¬∑ Run laundry & dishwasher only when full</div>
        <p class="calc-step-text">
          Full loads reduce waste by <strong>25‚Äì35%</strong>.
          ECO mode saves another <strong>20‚Äì40%</strong> per cycle.
        </p>
      </div>

      <div class="step-block">
        <div class="step-label">üîå 5 ¬∑ Kill standby power</div>
        <p class="calc-step-text">
          Devices on standby quietly consume <strong>5‚Äì20%</strong> of your bill.
          Smart plugs + turning things off removes this <strong>silent cost</strong>.
        </p>
      </div>

      <div class="step-block">
        <div class="step-label">üç≥ 6 ¬∑ Cook efficiently (lids, microwave, air fryer)</div>
        <p class="calc-step-text">
          Using lids + shorter cooking time saves <strong>10‚Äì30%</strong>.
          Microwave/air fryer uses <strong>50‚Äì70% less</strong> energy than the oven.
        </p>
      </div>

      <div class="step-block">
        <div class="step-label">üí° 7 ¬∑ Use LED bulbs everywhere</div>
        <p class="calc-step-text">
          LEDs use <strong>75‚Äì85% less</strong> electricity and last
          <strong>10√ó longer</strong>. Easily cuts lighting costs by
          <strong>50‚Äì70%</strong>.
        </p>
      </div>

      <div class="step-block">
        <div class="step-label">ü™ü 8 ¬∑ Block drafts + keep heat inside</div>
        <p class="calc-step-text">
          Drafts waste <strong>10‚Äì25%</strong> of heating.
          Seal gaps, close curtains at night, and shut doors to reduce heat loss
          by <strong>15‚Äì30%</strong>.
        </p>
      </div>

      <div class="step-block">
        <div class="step-label">üå¨Ô∏è 9 ¬∑ Fans/blankets instead of AC/heaters</div>
        <p class="calc-step-text">
          Space heaters cost <strong>10√ó more</strong> to run than a heated throw.
          Fans use <strong>90% less</strong> electricity than AC.
          Saves <strong>10‚Äì20%</strong> seasonally.
        </p>
      </div>

      <div class="step-block">
        <div class="step-label">üìè 10 ¬∑ Set simple house rules</div>
        <p class="calc-step-text">
          Coordination alone avoids <strong>20‚Äì40%</strong> of wasted energy and water.
          Clear routines = fewer long showers, fewer lights left on, and no
          ‚Äúheating wars.‚Äù
        </p>
      </div>
      <div class="step-block" style="margin-top: 12px;">
        <div class="step-label">üìö Sources</div>
        <p class="calc-step-text" style="font-size: 12px; color: #9ca3af;">
          Eurostat ‚Äî household energy breakdown<br>
          Energy Saving Trust ‚Äî thermostat & heating impact<br>
          British Gas ‚Äî appliance & shower efficiency<br>
          GreenMatch UK ‚Äî standby consumption (5‚Äì20%)<br>
          Made Blue Foundation ‚Äî shower & water data<br>
          Cladco ‚Äî appliance water use<br>
          Profee ‚Äî cooking efficiency statistics<br>
          Alsavo ‚Äî EU energy efficiency incentives<br>
          Refinery29 ‚Äî roommate heating behavior in Europe
        </p>
      </div>

    </div> <!-- end calc-body -->
  </div>
</div>


 <!-- FEEDBACK OVERLAY -->
  <div id="feedbackOverlay" class="calc-overlay">
    <div class="calc-modal">
      <div class="calc-header">
        <div class="calc-title">Your feedback is essential üíõ</div>
        <button id="feedbackCloseBtn" class="calc-close">‚úï</button>
      </div>

      <div class="calc-body">
        <p class="calc-step-text" style="margin-bottom:10px;">
          Bill by Days is only a few days old. Your feedback helps decide if this
          thing has a future ‚Äì good or bad, everything is gold.
        </p>

        <!-- Stars -->
        <div id="feedbackStars"
          style="display:flex;gap:6px;font-size:24px;margin-bottom:10px;cursor:pointer;">
          <span data-star="1">‚òÜ</span>
          <span data-star="2">‚òÜ</span>
          <span data-star="3">‚òÜ</span>
          <span data-star="4">‚òÜ</span>
          <span data-star="5">‚òÜ</span>
        </div>

        <!-- Message -->
        <textarea id="feedbackMessage"
          placeholder="Tell me what worked, what didn‚Äôt, or any ideas you have..."
          style="width:100%;height:90px;padding:10px;border-radius:12px;border:1px solid #e5e7eb;margin-bottom:10px;font-size:13px;"></textarea>

        <!-- Optional contact -->
        <input id="feedbackEmail" type="text"
          placeholder="Email or Instagram (optional)"
          style="width:100%;padding:10px;border-radius:12px;border:1px solid #e5e7eb;margin-bottom:12px;font-size:13px;">

        <button id="sendFeedbackBtn"
          class="primary-btn"
          style="width:100%;border-radius:999px;background:#facc15;color:#111827;">
          Send feedback
        </button>

        <p id="feedbackStatus" style="font-size:12px;margin-top:8px;"></p>
      </div>
    </div>
  </div>

   <!-- REPORT OVERLAY (PRO ONLY) -->
<div id="reportOverlay" class="report-overlay">
  <div class="report-shell" id="reportShell">
    <div class="report-header">
      <div>
        <div class="report-title">Bill report</div>
        <div class="report-subtitle">See how this bill was split.</div>
        <div id="reportMeta" class="report-meta"></div>
      </div>
      <button id="reportCloseBtn" class="report-close-btn">‚úï</button>
    </div>

    
        <!-- Scrollable content -->
       <div class="report-sections">

           <!-- üçé Apple-style highlight card: fixed vs variable -->
      <section class="report-highlight-card">
        <div class="report-highlight-header">
          <div>
            <div class="report-highlight-title">Global Bill breakdown</div>
            <div class="report-highlight-sub">
              How much of this bill is fixed vs variable.
            </div>
          </div>
          <div id="reportHighlightMeta" class="report-highlight-meta"></div>
        </div>

        <div class="report-highlight-body">
          <div class="report-highlight-chart">
            <!-- IMPORTANT: this id must match JS -->
            <canvas id="reportFixedVarChart"></canvas>
          </div>
          <div class="report-highlight-text">
            <div id="reportHighlightLine1" class="report-highlight-line"></div>
            <div id="reportHighlightLine2" class="report-highlight-line"></div>
          </div>
        </div>
      </section>

      <!-- 2Ô∏è‚É£ Bill composition ‚Äì GLOBAL, right after breakdown -->
      <section class="report-section" id="reportCompositionSection">
        <h3 class="report-section-title">Global Bill composition</h3>

        <!-- Top: small cards per expense -->
        <div id="reportCompositionList" class="report-comp-grid"></div>

        <!-- Bottom: donut with share of total bill -->
        <div class="report-comp-chart-card">
          <div class="report-comp-chart-title">Share of total bill</div>
          <canvas id="billCompositionChart"></canvas>
        </div>
      </section>

      <!-- 3Ô∏è‚É£ Split by roommate cards (moved up here) -->
      <section class="report-section">
        <h3 class="report-section-title">Split by roommate</h3>
        <div id="reportSplit"></div>
      </section>

        <section class="report-section" id="reportCostSection">
        <h3 class="report-section-title">Cost per day</h3>
        <div id="reportCostContent"></div>
      </section>

      <!-- (old ‚ÄúHow this bill is shared‚Äù + ‚ÄúOverview‚Äù temporarily removed) -->

      <!-- 4Ô∏è‚É£ How you compare to Portugal -->
<section class="report-section" id="portugalKpiSection">
  <h3 class="report-section-title">How you compare to Portugal</h3>

  <div class="kpi-grid">
    <!-- Tile 1: efficiency gauge -->
    <div class="kpi-tile" id="kpiGaugeTile">
      <div class="kpi-tile-header">
        <div class="kpi-tile-title"> your KPI ¬∑ Portugal</div>
        <div class="kpi-score-pill">
          <span id="kpiScoreValue">50</span>
          <span class="kpi-score-max">/100</span>
        </div>
      </div>
      <div class="kpi-tile-sub" id="kpiHouseholdLabel">4-person household</div>

   <div class="kpi-gauge-wrapper">
  <div class="kpi-gauge">
    <div class="kpi-gauge-arc"></div>
    <div class="kpi-gauge-needle" id="kpiGaugeNeedle"></div>
  </div>

  <div class="kpi-gauge-scale">
    <span>0</span>
    <span>50</span>
    <span>100</span>
  </div>
</div>



    </div>

    <!-- Tile 2: cost comparison -->
    <div class="kpi-tile" id="kpiCostTile">
      <div class="kpi-tile-header">
        <div class="kpi-tile-title">Monthly cost</div>
      </div>
      <div class="kpi-tile-sub" id="kpiDiffSummary">
        <!-- filled by JS -->
      </div>

      <div class="kpi-rows">
        <div class="kpi-row">
          <span>Your bill</span>
          <span id="kpiYourCost">‚Äî</span>
        </div>
        <div class="kpi-row">
          <span>Portugal average</span>
          <span id="kpiAvgCost">‚Äî</span>
        </div>
      </div>

      <div class="kpi-footnote">
        Based on public national averages for Portugal
        (ERSE, ERSAR, INE). Data year: <span id="kpiDataYear">‚Äî</span>.
      </div>
    </div>
  </div>
</section>

      </div> <!-- .report-sections -->
  </div>     <!-- .report-shell -->
</div>       <!-- #reportOverlay -->
 
<!-- ROOMMATE DETAIL OVERLAY (now OUTSIDE reportOverlay) -->
<div id="rmOverlay" class="rm-overlay">
  <div class="rm-modal">
    <div class="rm-modal-header">
      <div class="rm-modal-title-row">
        <div id="rmModalDot" class="rm-modal-dot"></div>
        <div id="rmModalTitle" class="rm-modal-title">Roommate</div>
      </div>
      <button id="rmModalClose" class="rm-modal-close">‚úï</button>
    </div>
    <div id="rmModalTotal" class="rm-modal-total">‚Ç¨0.00</div>
    <div id="rmModalSub" class="rm-modal-sub"></div>

    <div class="rm-modal-summary-grid">
      <div class="rm-modal-label">Share of bill</div>
      <div id="rmModalShare" class="rm-modal-value">0%</div>
      <div class="rm-modal-label">Fixed part</div>
      <div id="rmModalFixed" class="rm-modal-value">‚Ç¨0.00</div>
      <div class="rm-modal-label">Variable part</div>
      <div id="rmModalVariable" class="rm-modal-value">‚Ç¨0.00</div>
      <div class="rm-modal-label">Presence points</div>
      <div id="rmModalPoints" class="rm-modal-value">0.00</div>
      <div class="rm-modal-label">Days at home</div>
      <div id="rmModalDays" class="rm-modal-value">0</div>
    </div>

    <div class="rm-modal-exp-title">How each expense contributed:</div>
    <div id="rmModalExpenses"></div>
  </div>
</div>

<!-- Upgrade toast -->
<div id="upgradePopup" class="upgrade-popup">This is a Pro feature.</div>
<!-- Required for PDF export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>


<script src="step3.js"></script>
</body>
</html>
